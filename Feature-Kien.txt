this is Kien's code 
fix some bug in this file